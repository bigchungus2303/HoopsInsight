# Database Architecture - Visual Diagram

## ğŸ—„ï¸ Complete Database Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NBA PERFORMANCE PREDICTOR                     â”‚
â”‚                         DATABASE ARCHITECTURE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          nba_cache.db (SQLite)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚    players       â”‚  Player biographical info                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                               â”‚
â”‚  â”‚ id (PK)          â”‚  Cache expiry: 7 days                         â”‚
â”‚  â”‚ first_name       â”‚  Records: ~5-50 players                       â”‚
â”‚  â”‚ last_name        â”‚  Size: ~100 bytes/record                      â”‚
â”‚  â”‚ team_id          â”‚                                               â”‚
â”‚  â”‚ team_name        â”‚  Used by: Player search, display              â”‚
â”‚  â”‚ position         â”‚                                               â”‚
â”‚  â”‚ height, weight   â”‚                                               â”‚
â”‚  â”‚ last_updated     â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚         â”‚                                                            â”‚
â”‚         â”‚ player_id (FK relationship)                               â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚                                    â”‚                      â”‚
â”‚         â†“                                    â†“                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  season_stats    â”‚              â”‚   game_stats     â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ id (PK)          â”‚              â”‚ id (PK)          â”‚            â”‚
â”‚  â”‚ player_id (FK)   â”‚              â”‚ player_id (FK)   â”‚            â”‚
â”‚  â”‚ season           â”‚              â”‚ game_id          â”‚            â”‚
â”‚  â”‚ postseason       â”‚              â”‚ game_date        â”‚            â”‚
â”‚  â”‚ games_played     â”‚              â”‚ season           â”‚            â”‚
â”‚  â”‚ pts, reb, ast    â”‚              â”‚ postseason       â”‚            â”‚
â”‚  â”‚ fg%, 3p%, ft%    â”‚              â”‚ pts, reb, ast    â”‚            â”‚
â”‚  â”‚ min              â”‚              â”‚ fg%, 3pm, min    â”‚            â”‚
â”‚  â”‚ last_updated     â”‚              â”‚ last_updated     â”‚            â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚            â”‚
â”‚  â”‚ UNIQUE(player,   â”‚              â”‚ UNIQUE(player,   â”‚            â”‚
â”‚  â”‚  season, post)   â”‚              â”‚  game_id)        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   Cache: 1 day                      Cache: 1 day                   â”‚
â”‚   Records: ~100                     Records: ~2000 games           â”‚
â”‚   Per-game averages                 Individual game stats          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚            league_averages                           â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ season (PK)                                          â”‚          â”‚
â”‚  â”‚ pts, reb, ast (means)                                â”‚          â”‚
â”‚  â”‚ pts_std, reb_std, ast_std (std devs)                â”‚          â”‚
â”‚  â”‚ fg%, 3p%, ft% (means + std devs)                    â”‚          â”‚
â”‚  â”‚ last_updated                                         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚   Cache: 7 days                                                    â”‚
â”‚   Records: ~5 seasons                                              â”‚
â”‚   For z-score normalization                                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   favorites      â”‚              â”‚   predictions    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ id (PK)          â”‚              â”‚ id (PK)          â”‚            â”‚
â”‚  â”‚ player_id (UQ)   â”‚              â”‚ player_id (FK)   â”‚            â”‚
â”‚  â”‚ player_name      â”‚              â”‚ player_name      â”‚            â”‚
â”‚  â”‚ added_date       â”‚              â”‚ game_date        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ season           â”‚            â”‚
â”‚   No expiry                         â”‚ stat_type        â”‚            â”‚
â”‚   User preferences                  â”‚ threshold        â”‚            â”‚
â”‚                                     â”‚ predicted_prob   â”‚            â”‚
â”‚                                     â”‚ confidence       â”‚            â”‚
â”‚                                     â”‚ actual_result    â”‚            â”‚
â”‚                                     â”‚ actual_value     â”‚            â”‚
â”‚                                     â”‚ prediction_correctâ”‚           â”‚
â”‚                                     â”‚ created_at       â”‚            â”‚
â”‚                                     â”‚ verified_at      â”‚            â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                      No expiry                      â”‚
â”‚                                      Historical record              â”‚
â”‚                                            â”‚                        â”‚
â”‚                                            â”‚ Aggregates into        â”‚
â”‚                                            â†“                        â”‚
â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                     â”‚prediction_metricsâ”‚            â”‚
â”‚                                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚                                     â”‚ id (PK)          â”‚            â”‚
â”‚                                     â”‚ stat_type        â”‚            â”‚
â”‚                                     â”‚ threshold_range  â”‚            â”‚
â”‚                                     â”‚ total_predictionsâ”‚            â”‚
â”‚                                     â”‚ correct_pred     â”‚            â”‚
â”‚                                     â”‚ accuracy_rate    â”‚            â”‚
â”‚                                     â”‚ last_updated     â”‚            â”‚
â”‚                                     â”‚                  â”‚            â”‚
â”‚                                     â”‚ UNIQUE(stat,range)â”‚           â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                      Auto-updated                   â”‚
â”‚                                      Aggregate stats                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: User Loads Player

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚ "Load LeBron James"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app.py                                              â”‚
â”‚  api_client.get_season_stats(237, 2024)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  nba_api.py                                          â”‚
â”‚  1. Check database first                             â”‚
â”‚     db.get_season_stats(237, 2024)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  database.py                                         â”‚
â”‚  SELECT * FROM season_stats                          â”‚
â”‚  WHERE player_id=237 AND season=2024                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
       â”œâ”€â”€â”€ Cache Hit (found, < 1 day old)
       â”‚    â””â”€â†’ Return cached data
       â”‚        cache_hit_count++
       â”‚
       â””â”€â”€â”€ Cache Miss (not found or expired)
            â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  nba_api.py                      â”‚
       â”‚  2. Make API request              â”‚
       â”‚     GET balldontlie.io/v1/stats  â”‚
       â”‚     api_call_count++              â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  database.py                      â”‚
       â”‚  3. Cache response                â”‚
       â”‚     INSERT INTO season_stats      â”‚
       â”‚     VALUES (237, 2024, ...)      â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         Return data to app
```

---

## ğŸ¯ Prediction Tracking Flow

```
Step 1: Save Prediction
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "Save Prediction"          â”‚
â”‚ LeBron â‰¥20 pts, 65% probability       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ database.save_prediction(                           â”‚
â”‚   player_id=237,                                    â”‚
â”‚   player_name="LeBron James",                       â”‚
â”‚   game_date="2025-01-15",                          â”‚
â”‚   threshold=20.0,                                   â”‚
â”‚   predicted_probability=0.65,                       â”‚
â”‚   confidence="High"                                 â”‚
â”‚ )                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO predictions (...)                       â”‚
â”‚ VALUES (237, "LeBron", "2025-01-15", "pts", 20, ...) â”‚
â”‚                                                      â”‚
â”‚ actual_result = NULL  (not verified yet)           â”‚
â”‚ verified_at = NULL                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Returns prediction_id = 42

Step 2: Verify Prediction (After Game)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User enters actual result: 28 points   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ database.verify_prediction(                         â”‚
â”‚   prediction_id=42,                                 â”‚
â”‚   actual_value=28.0                                â”‚
â”‚ )                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Get prediction details (threshold=20)            â”‚
â”‚ 2. Calculate:                                       â”‚
â”‚    actual_result = 1 (28 >= 20)                    â”‚
â”‚    prediction_correct = 1 (predicted>0.5 and true) â”‚
â”‚ 3. UPDATE predictions SET                           â”‚
â”‚    actual_value=28, actual_result=1,               â”‚
â”‚    prediction_correct=1, verified_at=NOW           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Update aggregate metrics                         â”‚
â”‚    _update_prediction_metrics("pts", 20, correct=1) â”‚
â”‚                                                      â”‚
â”‚    UPDATE prediction_metrics SET                    â”‚
â”‚    total_predictions = total + 1                    â”‚
â”‚    correct_predictions = correct + 1                â”‚
â”‚    accuracy_rate = (correct/total)*100             â”‚
â”‚    WHERE stat_type='pts' AND threshold_range='high'â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Cache Hit Rate Calculation

```
Session Start:
api_call_count = 0
cache_hit_count = 0

User loads LeBron:
â”œâ”€ get_season_stats() â†’ Cache MISS â†’ API call
â”‚  api_call_count = 1
â”œâ”€ get_recent_games() â†’ Cache MISS â†’ API call  
â”‚  api_call_count = 2
â””â”€ get_career_stats() â†’ Cache MISS â†’ API call
   api_call_count = 3

User reloads LeBron:
â”œâ”€ get_season_stats() â†’ Cache HIT âœ“
â”‚  cache_hit_count = 1
â”œâ”€ get_recent_games() â†’ Cache HIT âœ“
â”‚  cache_hit_count = 2
â””â”€ get_career_stats() â†’ Cache HIT âœ“
   cache_hit_count = 3

Results:
total_requests = 6
cache_hit_rate = (3/6) * 100 = 50%
```

---

## ğŸ¨ ERD (Entity Relationship Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   players   â”‚â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ 1:N
      â†‘            â†“
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚      â”‚  season_stats   â”‚
      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”œâ”€â”€â”€â”€â”€â”€â”‚   game_stats    â”‚
      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”œâ”€â”€â”€â”€â”€â”€â”‚   favorites     â”‚
      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â””â”€â”€â”€â”€â”€â”€â”‚  predictions    â”‚â”€â”€â”€â”€â”
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ aggregates
                                    â”‚ into
                                    â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ prediction_metrics   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  league_averages    â”‚  Independent (no FK)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” SQL Examples

### **Cache a Player:**
```sql
INSERT OR REPLACE INTO players 
(id, first_name, last_name, team_name, team_abbreviation, position, last_updated)
VALUES (237, 'LeBron', 'James', 'Los Angeles Lakers', 'LAL', 'F', CURRENT_TIMESTAMP);
```

### **Get Cached Season Stats:**
```sql
SELECT * FROM season_stats
WHERE player_id = 237 
  AND season = 2024
  AND postseason = 0
  AND datetime(last_updated) > datetime('now', '-1 day');
```

### **Get Recent Games (Cached):**
```sql
SELECT * FROM game_stats
WHERE player_id = 237
  AND season = 2024
  AND postseason = 0
ORDER BY game_date DESC
LIMIT 20;
```

### **Track Prediction Accuracy:**
```sql
-- Save prediction
INSERT INTO predictions 
(player_id, player_name, game_date, stat_type, threshold, predicted_probability, prediction_confidence)
VALUES (237, 'LeBron James', '2025-01-15', 'pts', 20.0, 0.65, 'High');

-- Verify prediction
UPDATE predictions 
SET actual_value = 28.0,
    actual_result = 1,
    prediction_correct = 1,
    verified_at = CURRENT_TIMESTAMP
WHERE id = 42;

-- Get accuracy
SELECT stat_type, threshold_range, accuracy_rate, total_predictions
FROM prediction_metrics
WHERE total_predictions > 0
ORDER BY accuracy_rate DESC;
```

---

**This comprehensive documentation shows the complete database architecture, data flows, and how everything interacts!** ğŸ—„ï¸ğŸ“Š

